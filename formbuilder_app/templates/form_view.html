{% extends "base.html" %}
{% block title %}{{ form_to_view.title }}{% endblock %}
{% block content %}
    <!--suppress JSUnusedAssignment, JSUnresolvedVariable -->
    <div class="form-view main-container">
        <div class="form-head">
            <h1>{{ form_to_view.title }}</h1>
        </div>
        <div class="container main-container" style="padding-top: 140px">
            <div class="form-content">
                <form id="main-form" action="." method="post">
                    {% csrf_token %}
                    <input type="hidden" name="jsonFormSubmission" value="{{ form.jsonFormSubmission.value }}" required id="id_jsonFormSubmission">
                    <ol id="form-content" ></ol>
                    <button class="btn btn-lg width-full bg-primary">Submit</button>
                </form>
            </div>

            <script>
                var formArray = {{ form_to_view.jsonForm | safe }};
                var submissionArray = [];
                var formHtml = '';
                for (var i = 0; i < formArray.length; i++) {
                    formHtml += '<li>';
                    formHtml += '<label for="field' + i + '">' + formArray[i].label + ':</label>';
                    switch (formArray[i].fieldType) {
                        case "text":
                            formHtml += '<input type="text" name="field' + i + '" placeholder="Enter your answer..." required id="field' + i + '">';
                            break;
                        case "textarea":
                            formHtml += '<textarea name="field' + i + '" placeholder="Enter your answer..." required id="field' + i + '"></textarea>';
                            break;
                        case "select":
                            formHtml += '<select id="field' + i + '" name="field' + i + '" required>';
                            for (var j = 0; j < formArray[i].options.length; j++) {
                                formHtml += '<option value="' + formArray[i].options[j] + '">' + formArray[i].options[j] + '</option>';
                            }
                            formHtml += '</select>';
                            break;
                        default:
                            break;
                    }
                    formHtml += '</li>'
                }
                document.getElementById("form-content").innerHTML = formHtml;

            </script>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script>
        var submit = false;
        $('form#main-form').submit(function (event) {
            if (!submit) {
                event.preventDefault();
                for (var i = 0; i < formArray.length; i++) {
                    submissionArray.push(document.getElementById("field" + i).value);
                }
                document.getElementById("id_jsonFormSubmission").value = JSON.stringify(submissionArray);
                submit = true;
                $('form#main-form').submit();
            }
        });
    </script>
{% endblock %}