{% extends "dashboard_base.html" %}
{% block title %}Report: {{ form_to_report.title }}{% endblock %}
{% block content_dashboard %}
    <!--suppress HtmlUnknownTarget -->
    <h3>Report on: <b>{{ form_to_report.title }}</b></h3>
    <br>
    <div class="row" id="report-content">
    </div>

    <div id="delete-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title text-center">Are you sure you want to delete this form?</h4>
                </div>
                <div class="modal-body text-center">
                    <a id="delete-link" class="btn btn-success">
                        Yes, I'm sure
                    </a>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No, I'm not sure</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script src="/assets/lib/chart/Chart.min.js" ></script>
    <!--suppress JSUnresolvedVariable, JSDuplicatedDeclaration -->
    <script>
        var formArray = [];
        formArray = {{ form_to_report.jsonForm | safe }};
        var charts = [];

        {#        var reportHtml = "";#}

        for (var i = 0; i < formArray.length; i++) {
            var field = formArray[i];
            switch (field.fieldType) {
                case 'range': {
                    var labels = [];
                    var data = [];
                    var label = 'Responses to: "' + field.label + '"';

                    {% for submission in submissions %}
                        var submissionArray = [];
                        submissionArray = {{ submission.jsonSubmission | safe }};
                        labels.push("Submission {{ forloop.counter }}");
                        data.push(submissionArray[i]);
                    {% endfor %}

                    charts.push({id: i, labels: labels, data: data, label: label, type: "bar"});

                    document.getElementById("report-content").innerHTML += '\n' +
                        '        <div class="col-md-6">\n' +
                        '            <div class="panel panel-primary">\n' +
                        '                <div class="panel-heading">\n' +
                        '                    <div class="panel-title">' + label + ' (Bar Chart)</div>\n' +
                        '                </div>\n' +
                        '                <div class="panel-body">\n' +
                        '\n' +
                        '                    <canvas id="chart' + i + '" width="100%" height="100%"></canvas>\n' +
                        '                </div>\n' +
                        '            </div>\n' +
                        '        </div>;';

                    break;
                }
                case 'radio' || 'select': {
                    var labels = [];
                    var data = [];
                    var label = 'Responses to: "' + field.label + '"';

                    {% for submission in submissions %}
                        var submissionArray = [];
                        submissionArray = {{ submission.jsonSubmission | safe }};
                        labels.push("Submission {{ forloop.counter }}");
                        data.push(submissionArray[i]);
                    {% endfor %}

                    charts.push({id: i, labels: labels, data: data, label: label, type: "bar"});

                    document.getElementById("report-content").innerHTML += '\n' +
                        '        <div class="col-md-6">\n' +
                        '            <div class="panel panel-primary">\n' +
                        '                <div class="panel-heading">\n' +
                        '                    <div class="panel-title">' + label + ' (Bar Chart)</div>\n' +
                        '                </div>\n' +
                        '                <div class="panel-body">\n' +
                        '\n' +
                        '                    <canvas id="chart' + i + '" width="100%" height="100%"></canvas>\n' +
                        '                </div>\n' +
                        '            </div>\n' +
                        '        </div>;';

                    break;
                }
                default:
                    break;
            }
        }

        for (var j = 0; j < charts.length; j++) {
            var canvasContext = document.getElementById("chart" + charts[j].id).getContext('2d');
            switch (charts[j].type) {
                case 'bar' || 'horizontalBar':
                    var chart = new Chart(canvasContext, {
                        type: charts[j].type,
                        data: {
                            labels: charts[j].labels,
                            datasets: [{
                                label: charts[j].label,
                                data: charts[j].data,
                                backgroundColor: '#e21a72',
                                borderColor: '#AD1457',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            }
                        }
                    });
                    charts[j].chart = chart;
                    break;
                default:
                    break;
            }
        }

        {#        var chart = new Chart(canvasContext, {#}
        {#            type: 'doughnut',#}
        {#            data: {#}
        {#                labels: labels,#}
        {#                datasets: [{#}
        {#                    data: data,#}
        {#                    label: label,#}
        {#                    backgroundColor: '#e21a72',#}
        {#                    borderColor: '#AD1457',#}
        {#                    borderWidth: 1#}
        {#                }]#}
        {#            }#}
        {#        });#}
    </script>
{% endblock %}